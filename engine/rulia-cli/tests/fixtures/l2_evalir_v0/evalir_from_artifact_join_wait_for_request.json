{
  "format_id": "portable_workflow.eval_ir.v0",
  "ir_version": "v0",
  "artifact_hash": "sha256:5a5f6f8611994a505c1aa4ab9112ff478b783fae24da046aeb39c2a1ad6f1198",
  "entry_step_id": "S0001",
  "steps": [
    {
      "step_id": "S0001",
      "op": "choose_rules_v0",
      "rules": {
        "facts": [
          ["mode", "joined"]
        ],
        "rules": [
          {
            "head": ["route", ":join"],
            "body": [
              ["mode", "joined"]
            ]
          },
          {
            "head": ["route", ":request"],
            "body": [
              ["mode", "request"]
            ]
          }
        ],
        "query": ["route", "?r"],
        "selection": "canonical-first",
        "on_no_match": {
          "default": ":join"
        },
        "on_ambiguous": "choose-first"
      },
      "routes": {
        ":join": "S0003",
        ":request": "S0002"
      }
    },
    {
      "step_id": "S0002",
      "op": "request",
      "capability_id": "capability.approvals",
      "operation": "submit",
      "args": {
        "amount": 1250,
        "channel": "email"
      },
      "next_step_id": "S0003"
    },
    {
      "step_id": "S0003",
      "op": "join_obligations_v0",
      "obligations": [
        {
          "format": "rulia_obligation_v0",
          "obligation_type": "receipt_valid",
          "params": {
            "request_hash": "sha256:37ee0616861fec45df675d5024cab86198774a5144e4c741f4641a5d5c9ab609"
          }
        }
      ],
      "next_step_id": "S0004"
    },
    {
      "step_id": "S0004",
      "op": "assign",
      "path": "order.status",
      "value": "joined",
      "next_step_id": "S0005"
    },
    {
      "step_id": "S0005",
      "op": "end"
    }
  ]
}
